#!/usr/bin/env ruby
# frozen_string_literal: true

# NOTE: This console is designed to be run from the repo root directory. This
# is reflected in the filepaths used below.

require 'bundler/setup'
require 'byebug'
require 'dotenv'
require 'pry'

# Define a method to facilitate the hot reloading of code changes.
def reload
  original_verbose = $VERBOSE
  $VERBOSE = nil              # Suppress warning messages (from reloading CONSTANTS).
  load 'load.rb'              # (Re)load all code changes.
  $VERBOSE = original_verbose # Activate warning messages again globally.
  Wgit.logger.level = Logger::DEBUG

  true
end

# Load the most recent code into the session and include modules etc.
reload

# Connect to the database.
Dotenv.load
include DatabaseHelper # Connects to the database here.

# Seed some fixture data for the session.
db      = Database.new
crawler = Crawler.new
url     = Url.new(
  'http://txti.es',
  crawled: true,
  date_crawled: Time.now,
  crawl_duration: 0.567890
)
doc = Document.new(
  'http://www.mytestsite.com/home',
  File.read('test/mock/fixtures/test_doc.html')
)

# Print some basic usage information.
def info
  puts 'To load your code changes type: reload'
  puts 'Available fixture vars include: crawler, url, doc, db'
  puts 'Some helpful database manipulator methods include:'
  puts 'nuke, seed, index_page, index (site), search, db.num_records etc.'
  puts 'To see this information again type: info'
  puts "When you're finished type: exit (or press Ctrl+D)"
end

# Start the pry session.
puts "\nwgit v#{Wgit.version}\n\n"
info

binding.pry

# Do any post REPL cleanup tasks here...
puts 'Interactive session complete!'
